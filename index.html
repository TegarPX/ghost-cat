<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GhostChat - Ultra Private</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
.smooth{transition:.3s}
.mode-bright{background:#f1f5f9;color:#0f172a}
.card-bright{background:#fff;border:1px solid #e2e8f0}
.mode-dark{background:#0f172a!important}
.card-dark{background:#1e293b!important;border:1px solid #334155!important}

.chat-bubble-me{background:#2563eb;color:#fff;border-radius:18px 18px 0 18px}
.chat-bubble-them{background:#475569;color:#fff;border-radius:18px 18px 18px 0}

#messageBox::-webkit-scrollbar{width:4px}
#messageBox::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:10px}

.mode-dark p,.mode-dark span,.mode-dark h1,.mode-dark h2,.mode-dark label{color:#e5e7eb}

.mode-dark input,.mode-dark textarea{
background:#020617!important;
color:#f8fafc!important;
caret-color:#f8fafc;
}
.mode-dark input::placeholder{color:#64748b}

.system-text{
font-size:10px;
font-weight:900;
text-transform:uppercase;
letter-spacing:.2em;
opacity:.6
}
</style>
</head>

<body id="mainBody"
class="mode-bright smooth min-h-screen flex flex-col items-center justify-center p-4 font-sans">

<!-- THEME -->
<div class="fixed top-5 right-5 z-50">
<button id="themeBtn" onclick="toggleTheme()"
class="p-3 rounded-2xl bg-white shadow-lg border flex gap-2">
<span id="themeIcon">ðŸŒ™</span>
<span id="themeText" class="text-xs font-bold uppercase">Dark</span>
</button>
</div>

<!-- SETUP -->
<div id="setupCard"
class="card-bright p-8 rounded-[2.5rem] shadow-2xl w-full max-w-md">

<div class="text-center mb-8">
<h1 class="text-3xl font-black text-blue-600">
GHOST<span class="text-slate-400">CHAT</span>
</h1>
<p class="text-xs opacity-50 uppercase">No Database â€¢ No Logs â€¢ RAM Only</p>
</div>

<div class="space-y-5">
<input id="roomLetter" maxlength="1" placeholder="A"
class="w-full p-4 rounded-2xl text-center text-2xl font-bold border">

<input id="roomNumber" type="number" min="1000" max="9999" placeholder="1000"
class="w-full p-4 rounded-2xl text-center text-2xl font-bold border">

<button onclick="initP2P()"
class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl">
Mulai Chatting
</button>
</div>
</div>

<!-- CHAT -->
<div id="chatInterface"
class="hidden w-full max-w-lg h-[90vh] card-bright rounded-[2.5rem]
shadow-2xl flex flex-col overflow-hidden">

<div class="p-6 bg-blue-600 text-white flex justify-between">
<div>
<p class="text-[10px] uppercase opacity-70">Privat Room</p>
<h2 id="activeRoomName" class="font-black text-xl">A-1000</h2>
</div>
<button onclick="location.reload()"
class="bg-white/20 px-4 py-2 rounded-xl text-xs font-bold">
Keluar
</button>
</div>

<div id="messageBox"
class="flex-1 p-6 overflow-y-auto flex flex-col gap-4">
<div class="self-center bg-slate-100 px-4 py-1 rounded-full text-[10px]">
Menunggu partner...
</div>
</div>

<div class="p-4 border-t flex gap-2">
<input id="messageInput" placeholder="Ketik pesan rahasia..."
class="flex-1 p-4 rounded-2xl outline-none">
<button onclick="sendPrivateMessage()"
class="bg-blue-600 text-white w-14 h-14 rounded-2xl">âž¤</button>
</div>
</div>

<script>
let peer, conn, isDark=false;

/* THEME */
function toggleTheme(){
isDark=!isDark;
mainBody.className=isDark
?"mode-dark smooth min-h-screen flex flex-col items-center justify-center p-4 font-sans"
:"mode-bright smooth min-h-screen flex flex-col items-center justify-center p-4 font-sans";
setupCard.className=isDark
?"card-dark p-8 rounded-[2.5rem] shadow-2xl w-full max-w-md"
:"card-bright p-8 rounded-[2.5rem] shadow-2xl w-full max-w-md";
chatInterface.classList.toggle("card-dark",isDark);
themeIcon.textContent=isDark?"â˜€ï¸":"ðŸŒ™";
themeText.textContent=isDark?"Bright":"Dark";
}

/* ===== P2P FIX TOTAL ===== */
function initP2P(){
const l=roomLetter.value.toUpperCase();
const n=roomNumber.value;
if(!l||!n) return alert("Isi room dulu!");

const roomId=`ghost-${l}-${n}`;

peer=new Peer(roomId);

peer.on("open",()=>{
showChat(l,n);
appendMessage("Menunggu partner...","system");
});

peer.on("connection",c=>{
conn=c;
setupConn();
});

peer.on("error",err=>{
if(err.type==="unavailable-id"){
peer=new Peer();
peer.on("open",()=>{
conn=peer.connect(roomId);
setupConn();
showChat(l,n);
});
}
});
}

function setupConn(){
conn.on("open",()=>{
appendMessage("Terhubung secara privat.","system");
});
conn.on("data",m=>{
appendMessage(m,"them");
});
}

function showChat(l,n){
setupCard.classList.add("hidden");
chatInterface.classList.remove("hidden");
activeRoomName.textContent=`${l}-${n}`;
}

function sendPrivateMessage(){
if(!conn||!conn.open) return;
const msg=messageInput.value.trim();
if(!msg) return;
conn.send(msg);
appendMessage(msg,"me");
messageInput.value="";
}

function appendMessage(text,type){
const d=document.createElement("div");
d.className=type==="me"
?"self-end chat-bubble-me p-4 max-w-[85%]"
:type==="them"
?"self-start chat-bubble-them p-4 max-w-[85%]"
:"self-center system-text";
d.textContent=text;
messageBox.appendChild(d);
messageBox.scrollTop=messageBox.scrollHeight;
}

messageInput.addEventListener("keydown",e=>{
if(e.key==="Enter") sendPrivateMessage();
});
</script>
</body>
</html>
